rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ============================================
    // Helper Functions
    // ============================================
    
    // Check if the authenticated user is an admin
    // Add more admin UIDs to this array as needed
    function isAdmin() {
      return request.auth != null && 
             request.auth.uid in ['Pw6izWRUHzam4qPrmEeE56fFsYC2'];
    }
    
    // ============================================
    // Resources Collection
    // ============================================
    // Stores blog posts, guides, prompts, and other resources
    match /resources/{resourceId} {
      // Read: Allow public reads (API routes filter by published status)
      //       This allows orderBy queries to work properly
      //       The API route filters out unpublished resources for public requests
      allow read: if true;
      
      // Write: Allow all writes (admin verification happens in API routes)
      //        API routes verify admin status before allowing create/update/delete
      allow create: if true;
      allow update: if true;
      allow delete: if true;
    }
    
    // ============================================
    // Workshop Participants Collection
    // ============================================
    // Stores participant data for the workshop slideshow
    match /workshop-participants/{participantId} {
      // Read: Public (anyone can view participants)
      allow read: if true;
      
      // Create: Anyone can add themselves as a participant
      allow create: if true;
      
      // Update: Users can only update their own data
      allow update: if request.auth != null && request.auth.uid == participantId;
      
      // Delete: Only admins can delete participants
      allow delete: if isAdmin();
    }
    
    // ============================================
    // Deployed Sites Collection
    // ============================================
    // Stores deployed site URLs for workshop showcase
    match /deployed-sites/{siteId} {
      // Read: Public (anyone can view submitted sites)
      allow read: if true;
      
      // Create: Anyone can submit their deployed site
      allow create: if true;
      
      // Delete: Only admins can delete sites
      allow delete: if isAdmin();
    }
    
    // ============================================
    // AI Knowledge Poll Collection
    // ============================================
    // Stores votes for the AI knowledge poll on slide 5
    match /ai-knowledge-poll/{voteId} {
      // Read: Public (anyone can view poll results)
      allow read: if true;
      
      // Create: Anyone can submit a vote
      allow create: if true;
      
      // Delete: Only admins can delete votes
      allow delete: if isAdmin();
    }
    
    // ============================================
    // Default Rule
    // ============================================
    // Deny all access to any other collections/documents
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
